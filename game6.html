<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pop Block Blast Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* Global Styles */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f7d7e3; /* Soft Pink/Purple Pop Background */
            margin: 0;
            /* 全てのフォントをBangersに統一 */
            font-family: 'Bangers', cursive; 
            flex-direction: column;
        }

        /* Title Style */
        h1 {
            font-family: 'Bangers', cursive;
            font-size: 4em;
            color: #ff69b4; /* Hot Pink */
            text-shadow: 4px 4px #8a2be2; /* Blue Violet Pop Shadow */
            margin-bottom: 20px;
        }

        /* Main Container */
        #main-wrapper {
            display: flex;
            gap: 20px;
            position: relative;
        }

        /* Game Board Styles */
        #game-container {
            border: 8px solid #8a2be2; /* Blue Violet Border */
            border-radius: 15px; /* Rounded corners */
            background-color: #ffffff; /* White background */
            display: inline-block;
            box-shadow: 10px 10px 0px 0px #ff69b4; /* Hot Pink Pop Shadow */
            position: relative;
            overflow: hidden; /* To keep cells inside the rounded border */
        }

        /* Info Panel (Score, etc.) */
        #info-panel {
            width: 150px;
            padding: 15px;
            background-color: #fff;
            border: 4px solid #8a2be2;
            border-radius: 10px;
            box-shadow: 5px 5px 0px 0px #ff69b4;
            text-align: center;
            height: fit-content;
        }
        #info-panel h2 {
            font-family: 'Bangers', cursive;
            color: #8a2be2;
            font-size: 1.5em;
            margin-top: 0;
            margin-bottom: 5px;
        }
        #score-display {
            font-family: 'Bangers', cursive;
            font-size: 3em;
            font-weight: bold;
            color: #ff69b4;
            margin-bottom: 20px;
        }
        #controls-info {
            font-size: 1em; /* Bangersは細いのでサイズを調整 */
            text-align: left;
            padding: 5px;
            color: #555;
            border-top: 2px dashed #ffb3e6; /* Rose dashed line */
            padding-top: 10px;
            margin-top: 10px;
        }
        #controls-info p {
            margin: 5px 0;
            font-weight: bold;
        }


        /* Individual Cell Styles */
        .cell {
            width: 30px;
            height: 30px;
            box-sizing: border-box;
            border: 1px solid #f0f0f0; /* Very light cell borders */
            float: left;
        }

        /* Pop Color Definitions (Block Styles) */
        .block-red { background-color: #ff5757; border: 2px outset #ff8a8a; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }
        .block-blue { background-color: #5757ff; border: 2px outset #8a8aff; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }
        .block-green { background-color: #57ff57; border: 2px outset #8aff8a; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }
        .block-yellow { background-color: #ffff57; border: 2px outset #ffff8a; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }
        .block-purple { background-color: #ff57ff; border: 2px outset #ff8aff; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }
        .block-orange { background-color: #ffaa57; border: 2px outset #ffcc8a; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }
        .block-cyan { background-color: #57ffff; border: 2px outset #8affff; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }
        .block-pink { background-color: #ff57aa; border: 2px outset #ff8acc; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }
        .block-lime { background-color: #aaff57; border: 2px outset #ccff8a; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }
        .block-teal { background-color: #57ffaa; border: 2px outset #8affcc; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }
        .block-navy { background-color: #57aaff; border: 2px outset #8accee; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }


        /* Clearfix for rows */
        .row::after {
            content: "";
            clear: both;
            display: table;
        }

        /* Game Over Screen */
        #game-over-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.98);
            z-index: 100;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            border-radius: 15px;
        }

        #game-over-screen .game-over-text {
            font-family: 'Bangers', cursive;
            font-size: 4em;
            color: #ff5757; /* Pop Red */
            text-shadow: 3px 3px #8a2be2;
            margin-bottom: 5px;
        }

        #final-score {
            font-size: 1.5em;
            color: #8a2be2; /* Pop Blue Violet */
            font-weight: bold;
        }

        #restart-button {
            padding: 10px 25px;
            font-size: 1.2em;
            font-family: 'Bangers', cursive;
            cursor: pointer;
            background-color: #57ffaa; /* Teal Pop Button */
            color: #333;
            border: 4px solid #8a2be2;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 6px #5757ff; /* Blue Pop Shadow */
            transition: all 0.1s;
        }

        #restart-button:active {
            box-shadow: 0 2px #5757ff;
            transform: translateY(4px);
        }

        /* --- Control Buttons Container --- */
        #control-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            width: 100%; /* Full width to center under game */
            max-width: 520px; /* Match game board width */
        }

        .game-button {
            padding: 10px 15px;
            font-size: 1.5em; /* Increased size for icons */
            /* フォントをBangersに統一 */
            font-family: 'Bangers', cursive; 
            font-weight: bold;
            cursor: pointer;
            background-color: #ffaa57; /* Orange */
            color: #333;
            border: 3px solid #ff69b4; /* Hot Pink Border */
            border-radius: 8px;
            box-shadow: 0 4px #ff5757; /* Red Shadow */
            transition: all 0.1s;
            flex-grow: 1; /* Distribute space evenly */
            display: flex;
            justify-content: center;
            align-items: center;
            line-height: 1; /* Adjust line height for icons */
        }

        .game-button:active {
            box-shadow: 0 1px #ff5757;
            transform: translateY(3px);
        }

        .game-button:first-child { background-color: #57aaff; box-shadow: 0 4px #5757ff; } /* Blue for Left */
        .game-button:first-child:active { box-shadow: 0 1px #5757ff; }
        .game-button:nth-child(2) { background-color: #ff57ff; box-shadow: 0 4px #ff57aa; } /* Purple for Rotate */
        .game-button:nth-child(2):active { box-shadow: 0 1px #ff57aa; }
        .game-button:nth-child(3) { background-color: #ffff57; box-shadow: 0 4px #ffaa57; } /* Yellow for Hard Drop */
        .game-button:nth-child(3):active { box-shadow: 0 1px #ffaa57; }
        .game-button:last-child { background-color: #57ff57; box-shadow: 0 4px #57ffaa; } /* Green for Right */
        .game-button:last-child:active { box-shadow: 0 1px #57ffaa; }

        /* Icon styles for buttons */
        .arrow {
            display: inline-block;
            font-size: 1.5em; /* Size of the arrow */
            font-weight: bold;
            line-height: 1;
        }

        .rotate-icon {
            font-size: 1.2em; /* Adjust for a good looking rotate icon */
        }
    </style>
</head>
<body>

<h1>POP BLOCK BLAST!</h1>

<div id="main-wrapper">
    <div id="game-container">
        <div id="game-over-screen">
            <p class="game-over-text">GAME OVER</p>
            <div id="final-score"></div>
            <button id="restart-button">RESTART</button>
        </div>
        </div>

    <div id="info-panel">
        <h2>SCORE</h2>
        <div id="score-display">0</div>
        
        <div id="controls-info">
            <p>Keyboard Controls:</p>
            <p>← → : Move</p>
            <p>↓ : Soft Drop</p>
            <p>↑ or Space : Rotate</p>
            <p>Enter : Hard Drop</p>
        </div>
    </div>
</div>

<div id="control-buttons">
    <button class="game-button" id="btn-left"><span class="arrow">←</span></button>
    <button class="game-button" id="btn-rotate"><span class="rotate-icon">&#x21BB;</span></button> 
    <button class="game-button" id="btn-hard-drop">DROP!</button>
    <button class="game-button" id="btn-right"><span class="arrow">→</span></button>
</div>

<script>
    // --- Game Configuration ---
    const COLS = 10;
    const ROWS = 20;
    const BLOCK_SIZE = 30;
    let DROP_INTERVAL = 1000;

    // Pop Block color class names (matching CSS)
    const COLORS = ['red', 'blue', 'green', 'yellow', 'purple', 'orange', 'cyan', 'pink', 'lime', 'teal', 'navy'];

    // Block shapes (Standard Tetrominoes and many Pentominoes)
    const SHAPES = [
        // Standard Tetrominoes (4 cells)
        [[1, 1, 1, 1]],            // I-Block
        [[1, 1], [1, 1]],          // O-Block
        [[0, 1, 0], [1, 1, 1]],    // T-Block
        [[1, 1, 0], [0, 1, 1]],    // Z-Block
        [[0, 1, 1], [1, 1, 0]],    // S-Block
        [[1, 0, 0], [1, 1, 1]],    // J-Block
        [[0, 0, 1], [1, 1, 1]],    // L-Block

        // Pentominoes (5 cells) - Added for complexity and variety
        [[1, 1, 1], [1, 0, 0], [1, 0, 0]], // F-Pentomino-like (rotated L)
        [[0, 1, 0], [1, 1, 1], [0, 1, 0]], // P-Pentomino-like (Plus/X)
        [[1, 1, 0], [0, 1, 0], [0, 1, 1]], // Y-Pentomino-like
        [[1, 1, 1, 1, 1
